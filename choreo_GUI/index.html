<!doctype html>
<html lang="en"><head>
<meta charset="UTF-8">

<title>choreo_GUI</title>
<link rel="shortcut icon" href="./img/eight_icon.png" type="image/x-icon">

<head>
<meta name="viewport" content="width=610px">
<link rel="stylesheet" href="./assets/css/style.css">
<link rel="stylesheet" href="./assets/css/main.css">
<link rel="stylesheet" href="./assets/css/w3.css">
<link rel="stylesheet" href="./assets/css/choreo_GUI.css">

<!-- Animation related -->
<link rel="stylesheet" href="assets/css/jquery-ui-1.10.2.custom.min.css">
<link href="assets/css/choreo_anims.css" rel="stylesheet" type="text/css">

<script src="assets/js/jquery-1.9.1.js"></script>
<script src="assets/js/jquery-ui.js"></script>
<script src="assets/js/ultbuttons1.1.min.js">//fixes an issue with unreponsive button clicks</script>
<script src="assets/js/jquery.ui.touch-punch.min.js">//makes ui elements touch enabled</script>


<script src="orbit_data.js"></script>
<script src="anim.js" type="text/javascript"></script>
<script type="text/javascript">
window.addEventListener("load", windowLoadHandler, false);
</script>

<!-- <script> window.location.reload(true) </script> -->



<meta http-equiv="cleartype" content="on">
<!-- <script src="./pyodide_dist/pyodide.js"></script> -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.21.2/full/pyodide.js"></script>


<script type="text/javascript">
async function loadPyodideAndPackages() {
  self.pyodide = await loadPyodide();
  await pyodide.loadPackage([
    "matplotlib",
    "sparseqr",
    "networkx",
    "./python_dist/choreo-0.1.0-cp310-cp310-emscripten_3_1_14_wasm32.whl"
  ]);
}
let pyodideReadyPromise = loadPyodideAndPackages();

</script>
</head>


<body onresize="OnWindowResize()">

<div class="content">
<div class="w3-bar w3-bar-block w3-light-grey open LeftTab" style="width:130px; position:absolute;">
  <button class="w3-bar-item w3-button" onclick="OpenCloseLeftTab()" style="text-align: center;">&#9776;</button>
  <button class="w3-bar-item w3-button w3-hover-pale-red LeftTabBtn Launch"       style="text-align: center" onclick="ClickLeftTabBtn('Launch')"      >Launch</button>
  <button class="w3-bar-item w3-button w3-hover-pale-red LeftTabBtn Geom"         style="text-align: center" onclick="ClickLeftTabBtn('Geom')"        >Geometry</button>
  <button class="w3-bar-item w3-button w3-hover-pale-red LeftTabBtn IO"           style="text-align: center" onclick="ClickLeftTabBtn('IO')"          >I/O</button>
  <button class="w3-bar-item w3-button w3-hover-pale-red LeftTabBtn Solver"       style="text-align: center" onclick="ClickLeftTabBtn('Solver')"      >Solver</button>
</div>
<div class="MarginLeftTop" style="margin-left:130px">
  <div class="w3-bar w3-light-grey TopTab Launch">
    <button class="w3-bar-item w3-button w3-hover-pale-red TopTabBtn Launch_Main"     onclick="ClickTopTabBtn('Launch_Main')"     >Main</button>
    <button class="w3-bar-item w3-button w3-hover-pale-red TopTabBtn Launch_Gallery"  onclick="ClickTopTabBtn('Launch_Gallery')"  >Gallery</button>
    <button class="w3-bar-item w3-button w3-hover-pale-red TopTabBtn Launch_Test"     onclick="ClickTopTabBtn('Launch_Test')"     >Test</button>
    <button class="w3-bar-item w3-button w3-hover-pale-red TopTabBtn Launch_Help"     onclick="ClickTopTabBtn('Launch_Help')"     >Help</button>
    <button class="w3-bar-item w3-button w3-hover-pale-red TopTabBtn Launch_About"    onclick="ClickTopTabBtn('Launch_About')"    >About</button>
  </div>
  <div class="w3-bar w3-light-grey TopTab Geom">
      <button class="w3-bar-item w3-button w3-hover-pale-red TopTabBtn Geom_Bodies"   onclick="ClickTopTabBtn('Geom_Bodies')">Bodies</button>
      <button class="w3-bar-item w3-button w3-hover-pale-red TopTabBtn Geom_Target"   onclick="ClickTopTabBtn('Geom_Target')">Target</button>
      <button class="w3-bar-item w3-button w3-hover-pale-red TopTabBtn Geom_Random"   onclick="ClickTopTabBtn('Geom_Random')">Random</button>
      <button class="w3-bar-item w3-button w3-hover-pale-red TopTabBtn Geom_Custom"   onclick="ClickTopTabBtn('Geom_Custom')">Custom</button>
  </div>
  <div class="w3-bar w3-light-grey TopTab IO">
      <button class="w3-bar-item w3-button w3-hover-pale-red TopTabBtn IO_Image"   onclick="ClickTopTabBtn('IO_Image')">Image</button>
      <button class="w3-bar-item w3-button w3-hover-pale-red TopTabBtn IO_Video"   onclick="ClickTopTabBtn('IO_Video')">Video</button>
  </div>
  <div class="w3-bar w3-light-grey TopTab Solver">
      <button class="w3-bar-item w3-button w3-hover-pale-red TopTabBtn Solver_Discr"  onclick="ClickTopTabBtn('Solver_Discr')" >Discretization</button>
      <button class="w3-bar-item w3-button w3-hover-pale-red TopTabBtn Solver_Optim"  onclick="ClickTopTabBtn('Solver_Optim')" >Optimizer</button>
      <button class="w3-bar-item w3-button w3-hover-pale-red TopTabBtn Solver_Loop"  onclick="ClickTopTabBtn('Solver_Loop')" >Loop</button>
      <button class="w3-bar-item w3-button w3-hover-pale-red TopTabBtn Solver_Checks" onclick="ClickTopTabBtn('Solver_Checks')">Checks</button>
  </div>
</div>
<div id="AnimationBlock">
  <div id="canvasContainer" >
    <canvas id="displayCanvas" width="480px" height="480px" style="position: absolute; z-index: 0;">
        Your browser does not support HTML5 canvas.
    </canvas>
    <canvas id="orbitLayerCanvas" width="480px" height="480px" style="position: absolute; z-index: 1;"></canvas>
    <canvas id="particleLayerCanvas" width="480px" height="480px" style="position: absolute; z-index: 2;"></canvas>
  </div>
  <div id="panelContainer">
    <div class="panelDoubleColumn">
        <div class="panelColumn1">
            <form>
                <div class="panelGroup">
                    <span style="color:#ccc">speed</span>
                    <div id="speedSlider"></div>
                </div>
                <br/>
                <input type="button"  id="startStopButton" class="buttonType1" value="stop"/>
                <input type="button"  id="trajectoryButton" class="buttonType1" value="hide trajectories"/>
                
            </form>
        </div>
        <div class="panelColumn2">
            <div id="radioHeader">Choose a choreography:</div>
            <div id="radioContainer">
            <form id="radioForm">
                <div id="orbitRadio"></div>
            </form>
            </div>
            <div id="navButtons">
            <form>
    <input type="button" id="btnPrevOrbit" class="buttonType2" value="&#9650; prev"/>
    <input type="button" id="btnNextOrbit" class="buttonType2" value="&#9660; next"/>
    </form>
            </div>
        </div>
    </div>
  </div>
</div>
<div class="MarginLeftBody">
  <div  id="LoadConfigFileDropArea" class="w3-container MainTab Launch_Main" style="display:none">
    <button class="w3-button w3-hover-pale-red w3-light-grey" onclick="SaveConfigFile()">Save Config File</button>
    <button class="w3-button w3-hover-pale-red w3-light-grey" for="LoadConfigFileBtn">Load Config File
      <input type="file" id="LoadConfigFileBtn" accept=".json" onchange="ClickLoadConfigFile(this.files); this.value=null ;" hidden>
    </button>
    <button class="w3-button w3-hover-pale-red w3-light-grey" onclick="ChoreoExecuteClick()">Choreo Execute!</button>
    <button class="w3-button w3-hover-pale-red w3-light-grey" onclick="ChoreoSaveInitStateClick()">Save Init state</button>
  </div>
  <div class="w3-container MainTab Launch_Gallery" style="display:none">
    <h2>Gallery</h2>
  </div>
  <div class="w3-container MainTab Launch_Test" style="display:none">
    <h2>Test</h2>
    <button class="w3-button w3-hover-pale-red w3-light-grey" onclick="TestClick()">Test</button>
  </div>
  <div class="w3-container MainTab Launch_Help" style="display:none">
    <h2>Help</h2>
  </div>
  <div class="w3-container MainTab Launch_About" style="display:none">
    <h2>About</h2>
  </div>
  <div class="w3-container MainTab Geom_Bodies" style="display:none">
    <h2>Bodies definition</h2>
    <br>
    <table id = "table_body_loop" style="table-layout: fixed;">
      <tr style="border-left-style:hidden;border-right-style:hidden;border-top-style:hidden;"><td style="width:120px;"><b><button class="w3-button w3-light-grey" style="text-align: center; font-size:16px" onclick="ClickAddBodyLoop()">Add Loop +</button></b></td></tr>
      <tr><td style="width:120px;"><b>Number of bodies</b></td></tr>
      <tr><td style="width:120px;"><b>Mass of bodies</b></td></tr>
      <tr><td style="width:120px;"><b>Symmetry name</b></td></tr>
      <tr><td style="width:120px;"><b>Symmetry k</b></td></tr>
      <tr><td style="width:120px;"><b>Symmetry l</b></td></tr>
      <tr><td style="width:120px;"><b>Symmetry m</b></td></tr>
      <tr><td style="width:120px;"><b>Symmetry p</b></td></tr>
      <tr><td style="width:120px;"><b>Symmetry q</b></td></tr>
      <tr><td style="width:120px;"><b>id range</b></td></tr>
    </table>
  </div>
  <div class="w3-container MainTab Geom_Target" style="display:none">
    <h2>Initial state Target</h2>
  </div>
  <div class="w3-container MainTab Geom_Random" style="display:none">
    <h2>Initial state Random</h2>
    <img src="img/Random_init_description.svg" alt="Description of the random initial state" height="360px" width="480px">
    <br>
    <div style = "max-width:350px; ">
      <table style="font-size:16px; border:none; display:table">
        <tr>
          <td style="border:none;" >
            <label for="input_coeff_ampl_o">Max amplitude</label>
          </td>
          <td style="border:none; max-width:90px; ">
            <input id ="input_coeff_ampl_o" type="text" value="1e-1">
          </td>
        </tr>
        <tr>
          <td style="border:none;" >
            <label for="input_coeff_ampl_min">Min amplitude</label>
          </td>
          <td style="border:none; max-width:90px; ">
            <input id ="input_coeff_ampl_min" type="text" value="1e-16">
          </td>
        </tr>
        <tr>
          <td style="border:none;" >
            <label for="input_k_infl">Bend index</label>
          </td>
          <td style="border:none; max-width:90px; ">
            <input id ="input_k_infl" type="number" value="3">
          </td>
        </tr>
        <tr>
          <td style="border:none;" >
            <label for="input_k_max">Vanishing index</label>
          </td>
          <td style="border:none; max-width:90px; ">
            <input id ="input_k_max" type="number" value="600">
          </td>
        </tr>
      </table>
    </div>
  </div>
  <div class="w3-container MainTab Geom_Custom" style="display:none">
    <h2>Custom Symmetry definition</h2>
    <br>
    <table id = "table_custom_sym" style="table-layout: fixed;">
      <tr style="border-left-style:hidden;border-right-style:hidden;border-top-style:hidden;"><td style="width:120px;"><b><button class="w3-button w3-light-grey" style="text-align: center; font-size:16px" onclick="ClickAddCustomSym()">Add Sym +</button></b></td></tr>
      <tr><td style="width:120px;min-height:40px;"><b>Loop target</b></td></tr>
      <tr><td style="width:120px;min-height:40px;"><b>Loop source</b></td></tr>
      <tr><td style="width:120px;min-height:40px;"><b>Reflection</b></td></tr>
      <tr><td style="width:120px;min-height:40px;"><b>Rot angle num</b></td></tr>
      <tr><td style="width:120px;min-height:40px;"><b>Rot angle den</b></td></tr>
      <tr><td style="width:120px;min-height:40px;"><b>Time Rev</b></td></tr>
      <tr><td style="width:120px;min-height:40px;"><b>Time Shift num</b></td></tr>
      <tr><td style="width:120px;min-height:40px;"><b>Time Shift den</b></td></tr>
    </table>
  </div>
  <div class="w3-container MainTab IO_Image" style="display:none">
    <h2>I/0 Image</h2>
  </div>
  <div class="w3-container MainTab IO_Video" style="display:none">
    <h2>I/0 Video</h2>
  </div>
  <div class="w3-container MainTab Solver_Discr" style="display:none">
    <h2>Solver Discretization</h2>
    <div style = "max-width:400px; ">
      <table style="font-size:16px; border:none; display:table">
        <tr>
          <td style="border:none;" ><label for="checkbox_exactJ">Use exact Jacobian</label></td>
          <td style="border:none;"><input id ="checkbox_exactJ" class="w3-check" type="checkbox" style="vertical-align: super" checked></td>
        </tr>
        <tr>
          <td style="border:none"><h>Number of coefficients for level 1: </h></td>
          <td style="border:none; max-width:100px; "><input type="number" id="input_ncoeff_init" value="300" ></td>
        </tr>
        <tr>
          <td style="border:none"><h>Max refinement levels: </h><span id="display_n_reconverge_it_max"></span></td>
          <td style="border:none; max-width:100px; "><input type="range" id="input_n_reconverge_it_max" value="2" min="1" max="5" oninput="SlideNReconvergeItMax()"></td>
        </tr>
      </table>
    </div>
  </div>
  <div class="w3-container MainTab Solver_Optim" style="display:none">
    <h2>Optimizer</h2>
    <div style = "max-width:300px; ">
      <table style="font-size:16px; border:none; display:table">
        <tr>
          <td style="border:none;" >
            <label for="krylov_method">Krylov method:</label>
          </td>
          <td style="border:none; max-width:90px; ">
            <select class="w3-select" id="krylov_method"  name="krylov_method"> 
              <option value="lgmres">LGMRES</option>
              <option value="gmres">GMRES</option>
              <option value="bicgstab" selected>BiCGSTAB</option>
              <option value="cgs">CGS</option>
              <option value="minres">MINRES</option>
            </select>
          </td>
        </tr>
        <tr>
          <td style="border:none;" >
            <label for="linesearch_method">Line search method:</label>
          </td>
           <td style="border:none; max-width:90px; ">
            <select class="w3-select" id="linesearch_method" name="linesearch_method"> 
              <option value="wolfe" selected>Wolfe</option>
              <option value="armijo">Armijo</option>
            </select>
          </td>
        </tr>        <tr>
          <td style="border:none;" >
            <label for="input_Newt_err_norm_max">Max Newton Error:</label>
          </td>
           <td style="border:none; max-width:90px; ">
            <input type="text" id="input_Newt_err_norm_max" value="1e-14" >
          </td>
        </tr>
      </table>
    </div>
  </div>
  <div class="w3-container MainTab Solver_Loop" style="display:none">
    <h2>Structure of the convergence loop:</h2>
    <br>
    <table id = "table_cvg_loop" style="table-layout: fixed;">
      <tr style="border-left-style:hidden;border-right-style:hidden;border-top-style:hidden;"><td style="width:120px;"><b>
        <button class="w3-button w3-light-grey" style="text-align: center; font-size:16px" onclick="ClickAddColLoopKrylov()">Add +</button>
      </b></td></tr>
      <tr><td style="width:120px;"><b>Gradient tolerance</b></td></tr>
      <tr><td style="width:120px;"><b>Max iterations</b></td></tr>
      <tr><td style="width:120px;"><b>Max inner iterations</b></td></tr>
      <tr><td style="width:120px;"><b>Outer k</b></td></tr>
      <tr><td style="width:120px;"><b>Store outer Av</b></td></tr>
    </table>
  </div>
  <div class="w3-container MainTab Solver_Checks" style="display:none">
    <h2>Solver Checks</h2>
    <div style = "max-width:350px; ">
      <table style="font-size:16px; border:none; display:table">
        <tr>
          <td style="border:none;" >
            <label for="checkbox_duplicates">Look for duplicates</label>
          </td>
          <td style="border:none; max-width:90px; ">
            <input id ="checkbox_duplicates" class="w3-check" type="checkbox" style="vertical-align: super" checked>
          </td>
        </tr>
        <tr>
          <td style="border:none;" >
            <label for="input_duplicate_eps">Duplicate hash min difference</label>
          </td>
          <td style="border:none; max-width:90px; ">
            <input id ="input_duplicate_eps" type="text" value="1e-8">
          </td>
        </tr>
        <tr>
          <td style="border:none;" >
            <label for="checkbox_escape">Look for loop escape</label>
          </td>
          <td style="border:none; max-width:90px; ">
            <input id ="checkbox_escape" class="w3-check" type="checkbox" style="vertical-align: super" checked>
          </td>
        </tr>
      </table>
    </div>
  </div>
</div>
</div>

<script src="./choreo_GUI.js"></script>

<script>

OnWindowResize()

ClickLeftTabBtn('Launch');

document.getElementById("LoadConfigFileDropArea").addEventListener('drop', DropConfigFile, false);

SlideNReconvergeItMax();

for (var i = 0; i < 8; i++) {
    ClickAddColLoopKrylov();
}

ClickAddBodyLoop();

</script>

</body>
</html>
